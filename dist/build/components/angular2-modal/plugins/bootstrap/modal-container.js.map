{"version":3,"file":"modal-container.js","sourceRoot":"","sources":["modal-container.ts"],"names":[],"mappings":"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","sourcesContent":["import {\r\n  Component,\r\n  ComponentFactoryResolver,\r\n  ViewContainerRef,\r\n  ViewChild,\r\n  ViewEncapsulation,\r\n  AfterViewInit,\r\n  ElementRef,\r\n  trigger,\r\n  state,\r\n  style,\r\n  keyframes,\r\n  animate,\r\n  transition\r\n} from '@angular/core';\r\n\r\nimport { createComponent, DialogRef, ModalCompileConfig } from '../../index';\r\n\r\nimport { Modal } from './modal';\r\nimport { supportsKey } from '../../framework/utils';\r\nimport { BSModalContext } from './modal-context';\r\n\r\n/**\r\n * A component that acts as a top level container for an open modal window.\r\n */\r\n@Component({\r\n  selector: 'modal-container',\r\n  host: {\r\n    'tabindex': '-1',\r\n    'role': 'dialog',\r\n    'class': 'modal',\r\n    'style': 'display: block',\r\n    '[style.position]': 'position',\r\n    '(body:keydown)': 'documentKeypress($event)'\r\n  },\r\n  animations: [\r\n    trigger('fade', [\r\n      transition('void => in', [\r\n        animate('100ms linear', keyframes([\r\n          style({ opacity: 0, transform: 'translate(0, -25%)' }),\r\n          style({ opacity: 0, transform: 'translate(0, -25%)' })\r\n        ])),\r\n        animate('300ms linear', keyframes([\r\n          style({ opacity: 0, transform: 'translate(0, -25%)', offset: 0 }),\r\n          style({ opacity: 1, transform: 'translate(0, -12.5%)', offset: 0.5 }),\r\n          style({ opacity: 1, transform: 'translate(0, 0)', offset: 1 })\r\n        ]))\r\n      ]),\r\n      state('out',  style({ opacity: 0, transform: 'translate(0, -25%)'} )),\r\n      transition('in => out', [\r\n        animate('150ms linear', keyframes([\r\n          style({ opacity: 1, transform: 'translate(0, 0)' }),\r\n          style({ opacity: 0, transform: 'translate(0, -12.5%)' }),\r\n        ]))\r\n      ])\r\n    ])\r\n  ],\r\n  encapsulation: ViewEncapsulation.None,\r\n  /* tslint:disable */\r\n  template: `<div [ngClass]=\"dialog.context.dialogClass\" \r\n          [class.modal-lg]=\"dialog.context.size == \\'lg\\'\"\r\n          [class.modal-sm]=\"dialog.context.size == \\'sm\\'\"\r\n          [@fade]=\"fadeState\">\r\n         <div class=\"modal-content\"              \r\n              style=\"display:block\"              \r\n              role=\"document\"\r\n              (clickOutside)=\"onClickOutside()\">\r\n            <div style=\"display: none\" #modalDialog></div>\r\n         </div>\r\n    </div>`\r\n  /* tslint:enable */\r\n})\r\nexport class BSModalContainer implements AfterViewInit {\r\n  public position: string;\r\n\r\n  fadeState: 'in' | 'out' = 'in';\r\n\r\n  @ViewChild('modalDialog', {read: ViewContainerRef}) private _viewContainer: ViewContainerRef;\r\n\r\n  constructor(public dialog: DialogRef<BSModalContext>,\r\n              private el: ElementRef,\r\n              private _compileConfig: ModalCompileConfig,\r\n              private _modal: Modal,\r\n              private _cr: ComponentFactoryResolver) {\r\n    if (!dialog.inElement) {\r\n      this.position = null;\r\n    } else {\r\n      this.position = 'absolute';\r\n    }\r\n    dialog.onDestroy.subscribe(() => this.fadeState = 'out');\r\n  }\r\n\r\n  ngAfterViewInit() {\r\n    if (this.el.nativeElement) {\r\n      this.el.nativeElement.focus();\r\n    }\r\n\r\n    /*  TODO:\r\n        In RC5 dynamic component creation is no longer async.\r\n        Somewhere down the pipe of the created component a value change happens that fires\r\n        a CD exception. setTimeout is a workaround that mimics the async behavior.\r\n        Find out the error and remove setTimeout.\r\n     */\r\n    setTimeout( () => {\r\n      this.dialog.contentRef = createComponent(\r\n        this._cr,\r\n        this._compileConfig.component,\r\n        this._viewContainer,\r\n        this._compileConfig.bindings);\r\n    });\r\n  }\r\n\r\n  onClickOutside() {\r\n    if (this._modal.isTopMost(this.dialog) && !this.dialog.context.isBlocking)\r\n      this.dialog.dismiss();\r\n  }\r\n\r\n  documentKeypress(event: KeyboardEvent) {\r\n    // check that this modal is the last in the stack.\r\n    if (!this._modal.isTopMost(this.dialog)) return;\r\n\r\n\r\n    if (supportsKey(event.keyCode, <any>this.dialog.context.keyboard)) {\r\n      this.dialog.dismiss();\r\n    }\r\n  }\r\n}\r\n"]}