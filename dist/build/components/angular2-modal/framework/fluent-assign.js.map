{"version":3,"file":"fluent-assign.js","sourceRoot":"","sources":["fluent-assign.ts"],"names":[],"mappings":";AACA,IAAM,cAAc,GAAG,IAAI,CAAC;AAC5B,IAAM,cAAc,GAAG,WAAW,CAAC;AAEnC,4BAA4B,IAAY;IACpC,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC;QACR,MAAM,IAAI,KAAK,CAAC,uDAAuD,CAAC,CAAC;IAC7E,CAAC;IAAC,IAAI,CAAC,EAAE,CAAC,CAAC,IAAI,IAAI,IAAI,CAAC,CAAC,CAAC;QACtB,MAAM,IAAI,KAAK,CAAC,oBAAkB,IAAI,uBAAoB,CAAC,CAAC;IAChE,CAAC;AACL,CAAC;AAED;;;;GAIG;AACH,kCAAkC,OAAY;IAC1C,MAAM,CAAC,MAAM,CAAC,mBAAmB,CAAC,OAAO,CAAC;SACrC,MAAM,CAAC,UAAA,IAAI,IAAI,OAAA,cAAc,CAAC,IAAI,CAAC,IAAI,CAAC,EAAzB,CAAyB,CAAC;SACzC,GAAG,CAAC,UAAA,IAAI,IAAI,OAAA,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,EAAd,CAAc,CAAC,CAAC;AACrC,CAAC;AAED,oBAA2B,IAAY;IACnC,MAAM,CAAC,cAAc,GAAG,IAAI,CAAC;AACjC,CAAC;AAFe,kBAAU,aAEzB,CAAA;AAED,mCAAmC,GAAQ,EAAE,YAAY,EAAE,KAA2B;IAClF,MAAM,CAAC,cAAc,CAAC,GAAG,EAAE,YAAY,EAAO;QAC1C,YAAY,EAAE,KAAK;QACnB,UAAU,EAAE,KAAK;QACjB,QAAQ,EAAE,KAAK;QACf,YAAK;KACR,CAAC,CAAC;AACP,CAAC;AAED;;;;;GAKG;AACH,4BAA4B,QAAa,EAAE,aAAqB;IAC5D,MAAM,CAAC,mBAAmB,CAAC,aAAa,CAAC;SACpC,OAAO,CAAC,UAAA,IAAI,IAAI,OAAM,QAAS,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC,GAAS,aAAc,CAAC,IAAI,CAAC,EAA9D,CAA8D,CAAC,CAAC;AACzF,CAAC;AAED;;;;;;;;;;;;;;;;;;GAkBG;AACH,yBAAmC,GAAM,EAAE,YAAoB,EAAE,SAA0B;IAA3F,iBAWC;IAXgE,yBAA0B,GAA1B,iBAA0B;IACvF,kBAAkB,CAAC,IAAI,CAAC,GAAG,EAAE,YAAY,CAAC,CAAC;IAE3C,IAAM,GAAG,GAAG,UAAU,CAAC,YAAY,CAAC,CAAC;IACrC,yBAAyB,CAAC,GAAG,EAAE,YAAY,EAAE,UAAC,KAAU;QACpD,EAAE,CAAC,CAAC,SAAS,IAAI,KAAI,CAAC,cAAc,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;YACxC,MAAM,IAAI,KAAK,CAAC,iCAA+B,YAAY,sBAAmB,CAAC,CAAC;QACpF,CAAC;QACD,GAAG,CAAC,GAAG,CAAC,GAAG,KAAK,CAAC;QACjB,MAAM,CAAC,GAAG,CAAC;IACf,CAAC,CAAC,CAAC;AACP,CAAC;AAXe,uBAAe,kBAW9B,CAAA;AAED;;;;;;;;;;;;;;;;;;;;;;;;;GAyBG;AACH,wBAAkC,GAAM,EAAE,YAAoB,EAC5B,eAAuB,EACvB,IAAqB;IAArB,oBAAqB,GAArB,YAAqB;IACnD,kBAAkB,CAAC,IAAI,CAAC,GAAG,EAAE,YAAY,CAAC,CAAC;IAE3C,yBAAyB,CAAC,GAAG,EAAE,YAAY,EAAE,UAAC,KAAU;QACpD,GAAG,CAAC,eAAe,CAAC,CAAC,KAAK,CAAC,CAAC;QAC5B,MAAM,CAAC,GAAG,CAAC;IACf,CAAC,CAAC,CAAC;IAEH,EAAE,CAAC,CAAC,IAAI,KAAK,IAAI,CAAC,CAAC,CAAC;QAChB,IAAM,GAAG,GAAG,UAAU,CAAC,YAAY,CAAC,EAC9B,QAAM,GAAG,UAAU,CAAC,eAAe,CAAC,CAAC;QAE3C,MAAM,CAAC,cAAc,CAAC,GAAG,EAAE,GAAG,EAAO;YACjC,YAAY,EAAE,KAAK;YACnB,UAAU,EAAE,KAAK;YACjB,GAAG,EAAE,cAAM,OAAA,GAAG,CAAC,QAAM,CAAC,EAAX,CAAW;SACzB,CAAC,CAAC;IACP,CAAC;AACL,CAAC;AApBe,sBAAc,iBAoB7B,CAAA;AAiBD;;GAEG;AACH;IAGI,6BAAY,YAA8B;QACtC,IAAI,CAAC,aAAa;YACd,YAAY,YAAY,YAAY,GAAG,YAAY,GAAQ,IAAI,YAAY,EAAE,CAAC;IACtF,CAAC;IAED;;;;;OAKG;IACH,uCAAS,GAAT,UAAU,IAAY,EAAE,YAA6B;QAA7B,4BAA6B,GAA7B,wBAA6B;QACjD,eAAe,CAAC,IAAI,CAAC,aAAa,EAAE,IAAI,CAAC,CAAC;QAC1C,EAAE,CAAC,CAAC,YAAY,KAAK,SAAS,CAAC,CAAC,CAAC;YACvB,IAAI,CAAC,aAAc,CAAC,IAAI,CAAC,CAAC,YAAY,CAAC,CAAC;QAClD,CAAC;QACD,MAAM,CAAC,IAAI,CAAC;IAChB,CAAC;IAMD,sBAAI,6CAAY;QAJhB;;;WAGG;aACH;YACI,MAAM,CAAC,IAAI,CAAC,aAAa,CAAC;QAC9B,CAAC;;;OAAA;IACL,0BAAC;AAAD,CAAC,AA7BD,IA6BC;AA7BY,2BAAmB,sBA6B/B,CAAA;AAID;;;;;;;;;;;GAWG;AACH;IA0BI;;;;;OAKG;IACH,sBAAY,aAAkC,EAClC,cAAoC,EACpC,QAAiC;QAlCjD,iBAiEC;QAjCe,6BAAkC,GAAlC,yBAAkC;QAClC,8BAAoC,GAApC,0BAAoC;QACpC,wBAAiC,GAAjC,oBAAiC;QACzC,EAAE,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,aAAa,CAAC,CAAC,CAAC,CAAC;YAC/B,aAAa,CAAC,OAAO,CAAC,UAAA,CAAC,IAAI,OAAA,kBAAkB,CAAC,KAAI,EAAE,CAAC,CAAC,EAA3B,CAA2B,CAAC,CAAC;QAC5D,CAAC;QAAC,IAAI,CAAC,EAAE,CAAC,CAAC,aAAa,CAAC,CAAC,CAAC;YACvB,kBAAkB,CAAC,IAAI,EAAE,aAAa,CAAC,CAAC;QAC5C,CAAC;QAED,EAAE,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC;YAEhC,cAAc,CAAC,OAAO,CAAC,UAAA,IAAI,IAAI,OAAA,eAAe,CAAC,KAAI,EAAE,IAAI,CAAC,EAA3B,CAA2B,CAAC,CAAC;QAChE,CAAC;QAED,EAAE,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC;YACX,IAAI,CAAC,eAAe,GAAG,QAAQ,CAAC;QACpC,CAAC;IACL,CAAC;IA9CD;;;;;OAKG;IACI,oBAAO,GAAd,UAAkB,aAA4B,EAC5B,cAAoC;QADpC,6BAA4B,GAA5B,yBAA4B;QAC5B,8BAAoC,GAApC,0BAAoC;QAElD,MAAM,CAAM,YAAY,CAAC,WAAW,CAChC,IAAI,YAAY,CAAI,aAAa,EAAE,cAAc,CAAC,CAAC,CAAC;IAC5D,CAAC;IAED;;;;;OAKG;IACI,wBAAW,GAAlB,UAAsB,YAAe;QACjC,MAAM,CAAM,IAAI,mBAAmB,CAAW,YAAY,CAAC,CAAC;IAChE,CAAC;IA2BD,6BAAM,GAAN;QAAA,iBAaC;QAZG,MAAM,CAAC,wBAAwB,CAAC,IAAI,CAAC;aAChC,MAAM,CAAC,UAAC,GAAM,EAAE,IAAY;YACzB,IAAM,GAAG,GAAG,UAAU,CAAC,IAAI,CAAC,CAAC;YAC7B,4DAA4D;YAC5D,IAAI,QAAQ,GAAG,MAAM,CAAC,wBAAwB,CAAC,KAAI,EAAE,GAAG,CAAC,CAAC;YAC1D,EAAE,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC;gBACX,MAAM,CAAC,cAAc,CAAC,GAAG,EAAE,IAAI,EAAE,QAAQ,CAAC,CAAC;YAC/C,CAAC;YAAC,IAAI,CAAC,CAAC;gBACE,GAAI,CAAC,IAAI,CAAC,GAAS,KAAK,CAAC,GAAG,CAAC,CAAC;YACxC,CAAC;YACD,MAAM,CAAC,GAAG,CAAC;QACf,CAAC,EAAE,IAAI,CAAC,eAAe,GAAG,IAAI,IAAI,CAAC,eAAe,EAAE,GAAQ,EAAE,CAAC,CAAC;IACxE,CAAC;IACL,mBAAC;AAAD,CAAC,AAjED,IAiEC;AAjEY,oBAAY,eAiExB,CAAA","sourcesContent":["import {extend, arrayUnion} from './utils';\r\nconst PRIVATE_PREFIX = '$$';\r\nconst RESERVED_REGEX = /^(\\$\\$).*/;\r\n\r\nfunction validateMethodName(name: string) {\r\n    if (!name) {\r\n        throw new Error(`Illegal method name. Empty method name is not allowed`);\r\n    } else if (name in this) {\r\n        throw new Error(`A member name '${name}' already defined.`);\r\n    }\r\n}\r\n\r\n/**\r\n * Returns a list of assigned property names (non private)\r\n * @param subject\r\n * @returns {string[]}\r\n */\r\nfunction getAssignedPropertyNames(subject: any): string[] {\r\n    return Object.getOwnPropertyNames(subject)\r\n        .filter(name => RESERVED_REGEX.test(name))\r\n        .map(name => name.substr(2));\r\n}\r\n\r\nexport function privateKey(name: string): string {\r\n    return PRIVATE_PREFIX + name;\r\n}\r\n\r\nfunction objectDefinePropertyValue(obj: any, propertyName, value: (value: any) => void): void {\r\n    Object.defineProperty(obj, propertyName, <any>{\r\n        configurable: false,\r\n        enumerable: false,\r\n        writable: false,\r\n        value\r\n    });\r\n}\r\n\r\n/**\r\n * Given a FluentAssign instance, apply all of the supplied default values so calling\r\n * instance.toJSON will return those values (does not create a setter function)\r\n * @param instance\r\n * @param defaultValues\r\n */\r\nfunction applyDefaultValues(instance: any, defaultValues: Object): void {\r\n    Object.getOwnPropertyNames(defaultValues)\r\n        .forEach(name => (<any>instance)[privateKey(name)] = (<any>defaultValues)[name]);\r\n}\r\n\r\n/**\r\n * Create a function for setting a value for a property on a given object.\r\n * @param obj The object to apply the key & setter on.\r\n * @param propertyName The name of the property on the object\r\n * @param writeOnce If true will allow writing once (default: false)\r\n *\r\n * Example:\r\n * let obj = new FluentAssign<any>;\r\n * setAssignMethod(obj, 'myProp');\r\n * obj.myProp('someValue');\r\n * const result = obj.toJSON();\r\n * console.log(result); //{ myProp: 'someValue' }\r\n *\r\n *\r\n * let obj = new FluentAssign<any>;\r\n * setAssignMethod(obj, 'myProp', true); // applying writeOnce\r\n * obj.myProp('someValue');\r\n * obj.myProp('someValue'); // ERROR: Overriding config property 'myProp' is not allowed.\r\n */\r\nexport function setAssignMethod<T>(obj: T, propertyName: string, writeOnce: boolean = false): void {\r\n    validateMethodName.call(obj, propertyName);\r\n\r\n    const key = privateKey(propertyName);\r\n    objectDefinePropertyValue(obj, propertyName, (value: any) => {\r\n        if (writeOnce && this.hasOwnProperty(key)) {\r\n            throw new Error(`Overriding config property '${propertyName}' is not allowed.`);\r\n        }\r\n        obj[key] = value;\r\n        return obj;\r\n    });\r\n}\r\n\r\n/**\r\n * Create a function for setting a value that is an alias to an other setter function.\r\n * @param obj The object to apply the key & setter on.\r\n * @param propertyName The name of the property on the object\r\n * @param srcPropertyName The name of the property on the object this alias points to\r\n * @param hard If true, will set a readonly property on the object that returns \r\n *        the value of the source property. Default: false\r\n *        \r\n * Example:\r\n * let obj = new FluentAssign<any> ;\r\n * setAssignMethod(obj, 'myProp'); \r\n * setAssignAlias(obj, 'myPropAlias', 'myProp');\r\n * obj.myPropAlias('someValue');\r\n * const result = obj.toJSON();\r\n * console.log(result); //{ myProp: 'someValue' }\r\n * result.myPropAlias // undefined\r\n * \r\n *\r\n * let obj = new FluentAssign<any> ;\r\n * setAssignMethod(obj, 'myProp');\r\n * setAssignAlias(obj, 'myPropAlias', 'myProp', true); // setting a hard alias.\r\n * obj.myPropAlias('someValue');\r\n * const result = obj.toJSON();\r\n * console.log(result); //{ myProp: 'someValue' }\r\n * result.myPropAlias // someValue\r\n */\r\nexport function setAssignAlias<T>(obj: T, propertyName: string, \r\n                                  srcPropertyName: string, \r\n                                  hard: boolean = false): void {\r\n    validateMethodName.call(obj, propertyName);\r\n    \r\n    objectDefinePropertyValue(obj, propertyName, (value: any) => {\r\n        obj[srcPropertyName](value);\r\n        return obj;\r\n    });\r\n    \r\n    if (hard === true) {\r\n        const key = privateKey(propertyName), \r\n              srcKey = privateKey(srcPropertyName);\r\n\r\n        Object.defineProperty(obj, key, <any>{\r\n            configurable: false,\r\n            enumerable: false,\r\n            get: () => obj[srcKey]\r\n        });\r\n    }\r\n}\r\n\r\n/**\r\n * Describes a fluent assign method.\r\n * A function that gets a value and returns the instance it works on.\r\n */\r\nexport interface FluentAssignMethod<T, Z> {\r\n    //TODO: Setting 'this' instead of Z does not work, this=ConfigSetter here...\r\n    (value: T): Z;\r\n}\r\n\r\n\r\nexport interface IFluentAssignFactory<Z> {\r\n    fluentAssign: Z;\r\n    setMethod(name: string, defaultValue?: any): IFluentAssignFactory<Z>;\r\n}\r\n\r\n/**\r\n * Represent a fluent API factory wrapper for defining FluentAssign instances.\r\n */\r\nexport class FluentAssignFactory<T> {\r\n    private _fluentAssign: FluentAssign<T>;\r\n\r\n    constructor(fluentAssign?: FluentAssign<T>) {\r\n        this._fluentAssign =\r\n            fluentAssign instanceof FluentAssign ? fluentAssign : <any>new FluentAssign();\r\n    }\r\n\r\n    /**\r\n     * Create a setter method on the FluentAssign instance.\r\n     * @param name The name of the setter function.\r\n     * @param defaultValue If set (not undefined) set's the value on the instance immediately.\r\n     * @returns {FluentAssignFactory}\r\n     */\r\n    setMethod(name: string, defaultValue: any = undefined): FluentAssignFactory<T> {\r\n        setAssignMethod(this._fluentAssign, name);\r\n        if (defaultValue !== undefined) {\r\n            (<any>this._fluentAssign)[name](defaultValue);\r\n        }\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * The FluentAssign instance.\r\n     * @returns {FluentAssign<T>}\r\n     */\r\n    get fluentAssign(): FluentAssign<T> {\r\n        return this._fluentAssign;\r\n    }\r\n}\r\n\r\n\r\n\r\n/**\r\n * Represent an object where every property is a function representing an assignment function.\r\n * Calling each function with a value will assign the value to the object and return the object.\r\n * Calling 'toJSON' returns an object with the same properties but this time representing the\r\n * assigned values.\r\n *\r\n * This allows setting an object in a fluent API manner.\r\n * Example:\r\n let fluent = new FluentAssign<any>(undefined, ['some', 'went']);\r\n fluent.some('thing').went('wrong').toJSON();\r\n // { some: 'thing', went: 'wrong' }\r\n */\r\nexport class FluentAssign<T> {\r\n    private __fluent$base__: new () => T;\r\n\r\n    /**\r\n     * Returns a FluentAssignFactory<FluentAssign<T>> ready to define a FluentAssign type.\r\n     * @param defaultValues An object representing default values for the instance.\r\n     * @param initialSetters A list of initial setters for the instance.\r\n     * @returns {FluentAssignFactory<T>}\r\n     */\r\n    static compose<T>(defaultValues: T = undefined,\r\n                      initialSetters: string[] = undefined): FluentAssignFactory<T> {\r\n\r\n        return <any>FluentAssign.composeWith<FluentAssign<T>>(\r\n            new FluentAssign<T>(defaultValues, initialSetters));\r\n    }\r\n\r\n    /**\r\n     * Returns a FluentAssignFactory<Z> where Z is an instance of FluentAssign<?> or a derived\r\n     * class of it.\r\n     * @param fluentAssign An instance of FluentAssign<?> or a derived class of FluentAssign<?>.\r\n     * @returns {any}\r\n     */\r\n    static composeWith<Z>(fluentAssign: Z): IFluentAssignFactory<Z> {\r\n        return <any>new FluentAssignFactory<any>(<any>fluentAssign);\r\n    }\r\n    \r\n    /**\r\n     *\r\n     * @param defaultValues An object representing default values for the underlying object.\r\n     * @param initialSetters A list of initial setters for this FluentAssign.\r\n     * @param baseType the class/type to create a new base. optional, {} is used if not supplied.\r\n     */\r\n    constructor(defaultValues: T | T[] = undefined,\r\n                initialSetters: string[] = undefined,\r\n                baseType: new () => T = undefined) {\r\n        if (Array.isArray(defaultValues)) {\r\n            defaultValues.forEach(d => applyDefaultValues(this, d));\r\n        } else if (defaultValues) {\r\n            applyDefaultValues(this, defaultValues);\r\n        }\r\n        \r\n        if (Array.isArray(initialSetters)) {\r\n            \r\n            initialSetters.forEach(name => setAssignMethod(this, name));\r\n        }\r\n\r\n        if (baseType) {\r\n            this.__fluent$base__ = baseType;\r\n        }\r\n    }\r\n\r\n    toJSON(): T {\r\n        return getAssignedPropertyNames(this)\r\n            .reduce((obj: T, name: string) => {\r\n                const key = privateKey(name);\r\n                // re-define property descriptors (we dont want their value)\r\n                let propDesc = Object.getOwnPropertyDescriptor(this, key);\r\n                if (propDesc) {\r\n                    Object.defineProperty(obj, name, propDesc);\r\n                } else {\r\n                    (<any>obj)[name] = (<any>this)[key];\r\n                }\r\n                return obj;\r\n            }, this.__fluent$base__ ? new this.__fluent$base__() : <any>{});\r\n    }\r\n}\r\n"]}