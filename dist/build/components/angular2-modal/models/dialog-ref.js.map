{"version":3,"file":"dialog-ref.js","sourceRoot":"","sources":["dialog-ref.ts"],"names":[],"mappings":";AAEA,wBAAwB,cAAc,CAAC,CAAA;AAEvC,sBAAiC,oBAAoB,CAAC,CAAA;AAItD;;GAEG;AACH;IAsBE,mBAAmB,OAAW;QAAX,YAAO,GAAP,OAAO,CAAI;QAHtB,oBAAe,GAA0B,IAAI,wBAAgB,EAAO,CAAC;QACrE,eAAU,GAAkB,IAAI,iBAAO,EAAQ,CAAC;QAGtD,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,UAAU,CAAC,YAAY,EAAE,CAAC;IAClD,CAAC;IAMD,sBAAI,6BAAM;QAJV;;;WAGG;aACH;YACE,MAAM,CAAC,IAAI,CAAC,eAAe,CAAC,OAAO,CAAC;QACtC,CAAC;;;OAAA;IAED;;OAEG;IACH,yBAAK,GAAL,UAAM,MAAkB;QAAxB,iBAQC;QARK,sBAAkB,GAAlB,aAAkB;QACtB,IAAM,MAAM,GAAG;YACb,KAAI,CAAC,OAAO,EAAE,CAAC;YACf,KAAI,CAAC,eAAe,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;QACvC,CAAC,CAAC;QACF,IAAI,CAAC,SAAS,CAAU,aAAa,CAAC;aACnC,IAAI,CAAC,UAAA,KAAK,IAAI,OAAA,KAAK,KAAK,IAAI,IAAI,MAAM,EAAE,EAA1B,CAA0B,CAAC;aACzC,KAAK,CAAC,MAAM,CAAC,CAAC;IACnB,CAAC;IAED;;;;;;OAMG;IACH,2BAAO,GAAP;QAAA,iBAQC;QAPC,IAAM,QAAQ,GAAG;YACf,KAAI,CAAC,OAAO,EAAE,CAAC;YACf,KAAI,CAAC,eAAe,CAAC,MAAM,EAAE,CAAC;QAChC,CAAC,CAAC;QACF,IAAI,CAAC,SAAS,CAAU,eAAe,CAAC;aACrC,IAAI,CAAC,UAAA,KAAK,IAAI,OAAA,KAAK,KAAK,IAAI,IAAI,QAAQ,EAAE,EAA5B,CAA4B,CAAC;aAC3C,KAAK,CAAC,QAAQ,CAAC,CAAC;IACrB,CAAC;IAED,2BAAO,GAAP;QACE,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAC3B,IAAI,CAAC,UAAU,CAAC,QAAQ,EAAE,CAAC;IAC7B,CAAC;IAEO,6BAAS,GAAjB,UAAqB,IAAqC;QACxD,IAAM,QAAQ,GAAyB,IAAI,CAAC,UAAU,IAAI,IAAI,CAAC,UAAU,CAAC,QAAQ,EAChF,EAAE,GAAa,QAAQ,IAAI,OAAO,QAAQ,CAAC,IAAI,CAAC,KAAK,UAAU,IAAI,QAAQ,CAAC,IAAI,CAAC,CAAC;QAEpF,MAAM,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,QAAQ,CAAC,GAAG,KAAK,CAAC,CAAC;IACzD,CAAC;IACH,gBAAC;AAAD,CAAC,AA3ED,IA2EC;AA3EY,iBAAS,YA2ErB,CAAA","sourcesContent":["import { ComponentRef } from '@angular/core';\r\nimport { Observable } from 'rxjs/Observable';\r\nimport { Subject } from 'rxjs/Subject';\r\n\r\nimport { PromiseCompleter } from '../framework/utils';\r\nimport { ModalComponent } from '../models/tokens';\r\n\r\n\r\n/**\r\n * API to an open modal window.\r\n */\r\nexport class DialogRef<T> {\r\n  /**\r\n   * The reference to the component ref.\r\n   * @internal\r\n   * @return {ComponentRef<any>}\r\n   */\r\n  contentRef: ComponentRef<any>;\r\n\r\n  /**\r\n   * States if the modal is inside a specific element.\r\n   */\r\n  public inElement: boolean;\r\n\r\n  /**\r\n   * Fired before dialog is destroyed.\r\n   * No need to unsubscribe, done automatically.\r\n   */\r\n  public onDestroy: Observable<void>;\r\n\r\n  private _resultDeferred: PromiseCompleter<any> = new PromiseCompleter<any>();\r\n  private _onDestroy: Subject<void> = new Subject<void>();\r\n\r\n  constructor(public context?: T) {\r\n    this.onDestroy = this._onDestroy.asObservable();\r\n  }\r\n\r\n  /**\r\n   * A Promise that is resolved on a close event and rejected on a dismiss event.\r\n   * @returns {Promise<T>|any|*|Promise<any>}\r\n   */\r\n  get result(): Promise<any> {\r\n    return this._resultDeferred.promise;\r\n  }\r\n\r\n  /**\r\n   *  Close the modal with a return value, i.e: result.\r\n   */\r\n  close(result: any = null) {\r\n    const _close = () => {\r\n      this.destroy();\r\n      this._resultDeferred.resolve(result);\r\n    };\r\n    this._fireHook<boolean>('beforeClose')\r\n      .then(value => value !== true && _close())\r\n      .catch(_close);\r\n  }\r\n\r\n  /**\r\n   *  Close the modal without a return value, i.e: cancelled.\r\n   *  This call is automatically invoked when a user either:\r\n   *  - Presses an exit keyboard key (if configured).\r\n   *  - Clicks outside of the modal window (if configured).\r\n   *  Usually, dismiss represent a Cancel button or a X button.\r\n   */\r\n  dismiss() {\r\n    const _dismiss = () => {\r\n      this.destroy();\r\n      this._resultDeferred.reject();\r\n    };\r\n    this._fireHook<boolean>('beforeDismiss')\r\n      .then(value => value !== true && _dismiss())\r\n      .catch(_dismiss);\r\n  }\r\n\r\n  destroy() {\r\n    this._onDestroy.next(null);\r\n    this._onDestroy.complete();\r\n  }\r\n\r\n  private _fireHook<T>(name: 'beforeClose' | 'beforeDismiss'): Promise<T> {\r\n    const instance: ModalComponent<this> = this.contentRef && this.contentRef.instance,\r\n      fn: Function = instance && typeof instance[name] === 'function' && instance[name];\r\n\r\n    return Promise.resolve(fn ? fn.call(instance) : false);\r\n  }\r\n}\r\n"]}